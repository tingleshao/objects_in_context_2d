<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>generate2DDiscreteSrep (lib/srep_toolbox.rb)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/srep_toolbox.rb, line 18</span>
<span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate2DDiscreteSrep</span>(<span class="ruby-identifier">atoms</span>, <span class="ruby-identifier">spoke_length</span>, <span class="ruby-identifier">spoke_direction</span>, <span class="ruby-identifier">step_size</span>, <span class="ruby-identifier">srep_index</span>)
  <span class="ruby-comment cmt"># This function returns an srep which has parameters specified in the arguments lists</span>
  <span class="ruby-identifier">srep</span> = <span class="ruby-constant">SRep</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">index</span> = <span class="ruby-identifier">srep_index</span>       
  <span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">atom</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">spoke_length</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
        <span class="ruby-identifier">type</span> = <span class="ruby-value str">'end'</span>
    <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">type</span> = <span class="ruby-value str">'inner'</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-comment cmt"># normalize the u vector</span>
    <span class="ruby-identifier">usi</span> = <span class="ruby-identifier">spoke_direction</span>[<span class="ruby-identifier">i</span>]
    <span class="ruby-identifier">usi</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ui</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">usi</span>[<span class="ruby-identifier">index</span>] = [<span class="ruby-constant">Float</span>(<span class="ruby-identifier">ui</span>[<span class="ruby-value">0</span>]),<span class="ruby-constant">Float</span>(<span class="ruby-identifier">ui</span>[<span class="ruby-value">1</span>])]
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">usi</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ui</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">x</span> = <span class="ruby-identifier">ui</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">y</span> = <span class="ruby-identifier">ui</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">ui</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">foo</span>, <span class="ruby-identifier">index2</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">ui</span>[<span class="ruby-identifier">index2</span>] = <span class="ruby-identifier">foo</span> <span class="ruby-operator">/</span> <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">x</span><span class="ruby-operator">**</span><span class="ruby-value">2</span><span class="ruby-operator">+</span><span class="ruby-identifier">y</span><span class="ruby-operator">**</span><span class="ruby-value">2</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span> 
    <span class="ruby-comment cmt"># make sure the spoke length vector is in type Float</span>
    <span class="ruby-identifier">li</span> = <span class="ruby-identifier">spoke_length</span>[<span class="ruby-identifier">i</span>]
    <span class="ruby-identifier">li</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">li</span>[<span class="ruby-identifier">index</span>] = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">l</span>)
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-comment cmt"># make sure the positions x-y is in type Float</span>
    <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">foo</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">atom</span>[<span class="ruby-identifier">index</span>] = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">foo</span>)
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">atom_obj</span> = <span class="ruby-constant">Atom</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">li</span>, <span class="ruby-identifier">usi</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">atom</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">atom</span>[<span class="ruby-value">1</span>], <span class="ruby-constant">Color</span>.<span class="ruby-identifier">red</span>)
    <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">atom_obj</span>)
  <span class="ruby-keyword kw">end</span>
  <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">color</span> = <span class="ruby-constant">Color</span>.<span class="ruby-identifier">default</span>

  <span class="ruby-comment cmt"># compute the interpolated curve </span>
  <span class="ruby-identifier">xt</span> = <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">atom</span><span class="ruby-operator">|</span> <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">x</span> }
  <span class="ruby-identifier">yt</span> = <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">atom</span><span class="ruby-operator">|</span> <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">y</span> }
  <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;srep: index in toolbox: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">srep_index</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">curve</span> = <span class="ruby-identifier">interpolateSkeletalCurveGamma</span>(<span class="ruby-identifier">xt</span>, <span class="ruby-identifier">yt</span>, <span class="ruby-identifier">step_size</span>, <span class="ruby-identifier">srep_index</span>)
  <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">skeletal_curve</span> = <span class="ruby-identifier">curve</span>

  <span class="ruby-comment cmt"># compute indices </span>
  <span class="ruby-identifier">indices</span> = []
  <span class="ruby-identifier">indices</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">atom</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
      <span class="ruby-identifier">diff</span> = <span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span><span class="ruby-operator">-</span><span class="ruby-identifier">atom</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">abs</span> }
      <span class="ruby-identifier">v</span> = <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">diff</span>.<span class="ruby-identifier">min</span>)
      <span class="ruby-identifier">indices</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
  <span class="ruby-identifier">indices</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
  <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">base_index</span> = <span class="ruby-identifier">indices</span>   
  <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;indices: &quot;</span><span class="ruby-operator">+</span>  <span class="ruby-identifier">indices</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-comment cmt"># use the curve and upper spokes to get the value of lower spokes and end spokes </span>
  <span class="ruby-comment cmt"># calculate v at base points</span>
  <span class="ruby-identifier">v</span>= []
  <span class="ruby-identifier">v</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-value">-1</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">+</span><span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">0</span>]]), <span class="ruby-value">1</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">curve</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">+</span><span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">curve</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">0</span>]])]

  <span class="ruby-identifier">indices</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ind</span>, <span class="ruby-identifier">i</span> <span class="ruby-operator">|</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">indices</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">v</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">ind</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">ind</span>], <span class="ruby-value">-1</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">curve</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">ind</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">curve</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">ind</span>])]
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
  
  <span class="ruby-identifier">v</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">-1</span>]] <span class="ruby-operator">-</span> <span class="ruby-identifier">curve</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">-1</span>]<span class="ruby-operator">-</span><span class="ruby-value">1</span>], <span class="ruby-value">-1</span><span class="ruby-operator">*</span> (<span class="ruby-identifier">curve</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">-1</span>]]<span class="ruby-operator">-</span> <span class="ruby-identifier">curve</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">indices</span>[<span class="ruby-value">-1</span>]<span class="ruby-operator">-</span><span class="ruby-value">1</span>]) ] 
  <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;v: &quot;</span><span class="ruby-operator">+</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">refine</span> = <span class="ruby-keyword kw">true</span>
  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">refine</span>
  <span class="ruby-comment cmt"># make sure the upper and lower spokes have the same angle</span>
  <span class="ruby-comment cmt"># get the upper spokes directions </span>
    <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">atoms</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">atom</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> 
      <span class="ruby-identifier">u1</span> = <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">spoke_direction</span>[<span class="ruby-value">1</span>]  
      <span class="ruby-identifier">size_norm_v</span>=  <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">1</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span>)
      <span class="ruby-identifier">norm_v</span> = [<span class="ruby-identifier">v</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">size_norm_v</span> ,  <span class="ruby-identifier">v</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">1</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">size_norm_v</span> ]
      <span class="ruby-identifier">u1_proj_on_v</span> = <span class="ruby-identifier">norm_v</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span><span class="ruby-operator">*</span> (<span class="ruby-identifier">u1</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">norm_v</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">u1</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">norm_v</span>[<span class="ruby-value">1</span>])} 
      <span class="ruby-identifier">size_proj</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span> )
      <span class="ruby-identifier">norm_proj</span> = [<span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">size_proj</span>, <span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">size_proj</span>]
      <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;norm_v: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">norm_v</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;norm_proj: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">norm_proj</span>.<span class="ruby-identifier">to_s</span>

      <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;u1_proj_on_v: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u1_proj_on_v</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">u1_prep_to_v</span> = [<span class="ruby-identifier">u1</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">u1</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">1</span>]]
      <span class="ruby-identifier">u0</span> = [<span class="ruby-value">1</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">u1_prep_to_v</span>[<span class="ruby-value">0</span>], <span class="ruby-value">1</span>  <span class="ruby-operator">*</span>  <span class="ruby-identifier">u1_proj_on_v</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">u1_prep_to_v</span>[<span class="ruby-value">1</span>]]
      <span class="ruby-comment cmt"># normalize u0</span>
      <span class="ruby-identifier">u0_size</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">u0</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">**</span> <span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u0</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span>)  
      <span class="ruby-identifier">u0</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">u0</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">u0_size</span>
      <span class="ruby-identifier">u0</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">u0</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">u0_size</span>
      <span class="ruby-comment cmt">#check whether perpendicular</span>
      <span class="ruby-identifier">diff</span> = [<span class="ruby-identifier">u0</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">u1</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">u0</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">u1</span>[<span class="ruby-value">1</span>]]
      <span class="ruby-identifier">prod</span> = <span class="ruby-identifier">diff</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">norm_v</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">diff</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">*</span><span class="ruby-identifier">norm_v</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;prod: &quot;</span><span class="ruby-operator">+</span> <span class="ruby-identifier">prod</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">atom</span>.<span class="ruby-identifier">spoke_direction</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">u0</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-comment cmt"># for the end spokes, set their direction to the v </span>
    <span class="ruby-identifier">a0u2</span> = [<span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>], <span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>][<span class="ruby-value">1</span>]]
    <span class="ruby-identifier">a0u2_size</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">a0u2</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">**</span> <span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">a0u2</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span>)
    <span class="ruby-identifier">a0u2</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">a0u2</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">a0u2_size</span>
    <span class="ruby-identifier">a0u2</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">a0u2</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">a0u2_size</span>
    <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">atoms</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">spoke_direction</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">a0u2</span>

    <span class="ruby-identifier">aendu2</span> = [<span class="ruby-identifier">v</span>[<span class="ruby-value">-1</span>][<span class="ruby-value">0</span>], <span class="ruby-identifier">v</span>[<span class="ruby-value">-1</span>][<span class="ruby-value">1</span>]]
    <span class="ruby-identifier">aendu2_size</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">aendu2</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">**</span> <span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">aendu2</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">**</span><span class="ruby-value">2</span>)
    <span class="ruby-identifier">aendu2</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">aendu2</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">aendu2_size</span>
    <span class="ruby-identifier">aendu2</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">aendu2</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">/</span> <span class="ruby-identifier">aendu2_size</span>
    <span class="ruby-identifier">srep</span>.<span class="ruby-identifier">atoms</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">spoke_direction</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">aendu2</span>
  <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">srep</span>
<span class="ruby-keyword kw">end</span></pre>
</body>
</html>